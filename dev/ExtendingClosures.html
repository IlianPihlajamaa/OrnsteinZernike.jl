<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Defining your own closure · OrnsteinZernike.jl Documentation</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">OrnsteinZernike.jl Documentation</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Index</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="SingleCompLJ.html">First steps</a></li><li><a class="tocitem" href="HardSphereMixture.html">Hard-sphere mixture</a></li><li><a class="tocitem" href="HighDensities.html">Solving at high densities</a></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="GeneralWorkflow.html">General Workflow</a></li><li><a class="tocitem" href="Potentials.html">Interaction Potentials</a></li><li><a class="tocitem" href="Systems.html">Systems</a></li><li><a class="tocitem" href="Closures.html">Closures</a></li><li><a class="tocitem" href="Solvers.html">Solvers</a></li></ul></li><li><a class="tocitem" href="Theory.html">Theory</a></li><li><span class="tocitem">Extending</span><ul><li class="is-active"><a class="tocitem" href="ExtendingClosures.html">Defining your own closure</a><ul class="internal"><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li><li><a class="tocitem" href="ExtendingPotentials.html">Defining your own potentials</a></li></ul></li><li><a class="tocitem" href="API.html">API</a></li><li><a class="tocitem" href="FromPython.html">From Python</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Extending</a></li><li class="is-active"><a href="ExtendingClosures.html">Defining your own closure</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="ExtendingClosures.html">Defining your own closure</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/IlianPihlajamaa/OrnsteinZernike.jl/blob/main/docs/src/ExtendingClosures.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Defining-your-own-closure"><a class="docs-heading-anchor" href="#Defining-your-own-closure">Defining your own closure</a><a id="Defining-your-own-closure-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-your-own-closure" title="Permalink"></a></h1><p>Creating your own closure type is very easy. It takes two steps. First, the type itself must be created, and secondly, one of the methods that evaluates the closure must be overloaded. </p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Assume that we have forgotten that the HypernettedChain closure is already implemented, and we wanted to reimplement it. The hypernetted chain closure approximates <span>$c(r) \approx (f(r)+1)\\exp(\\gamma(r)) - \\gamma(r) - 1$</span>, or equivalently <span>$b(r) \approx 0$</span>.</p><p>First we define the type. Note that the new closure must be made a subtype of OrnsteinZernike.Closure</p><pre><code class="language-julia hljs">using OrnsteinZernike

import OrnsteinZernike.Closure
struct MyHNC &lt;: Closure end</code></pre><p>Now we can define how this closure should be evaluated. There are three options. One can overload either</p><ol><li><code>bridge_function(closure, r, mayer_f, γ, u_long_range)</code></li><li><code>closure_c_from_gamma(closure, r, mayer_f, γ, u_long_range)</code></li><li><code>closure_cmulr_from_gammamulr(closure, r, mayer_f, γ, u_long_range)</code></li></ol><p>Here, <code>mayer_f</code> is the Mayer-f function <span>$f(r) = exp(-\beta u(r)) - 1$</span>, and <code>u_long_range</code> is the tail part of the potential, if the closure needs that. </p><p>In practise, which of the three is overloaded can be arbitrary and depends on what is most convenient.</p><p>Here, we can for example either do</p><pre><code class="language-julia hljs">import OrnsteinZernike.bridge_function
function OrnsteinZernike.bridge_function(::MyHNC, _, _, _, _)
    return 0.0
end</code></pre><p>or</p><pre><code class="language-julia hljs">import OrnsteinZernike.closure_c_from_gamma
function OrnsteinZernike.closure_c_from_gamma(::MyHNC, _, mayer_f, γ, _)
    return (mayer_f + 1) * exp(γ) - γ - 1
end</code></pre><p>Now we can use the closure as any other </p><pre><code class="language- hljs">ϵ = 1.0
σ = 1.0
potential = SingleComponentLennardJones(ϵ, σ)
dims = 3 # we consider a 3D system
ρ = 0.01 # number density
kBT = 1.0 # thermal energy
system = SimpleLiquid(dims, ρ, kBT, potential)
closure = MyHNC()
sol = solve(system, closure)
using Plots
plot(sol.r, sol.gr, xlims=(0,5), xlabel=&quot;r&quot;, ylabel=&quot;g(r)&quot;)</code></pre><p>which can be compared to that of <a href="@ref">First Steps</a>.</p><p>In the case of multicomponent systems, instead of a number the function that is overloaded should return a <code>StaticMatrix</code> containing either values for <span>$c_{ij}$</span> or <span>$b_{ij}$</span>. Since, in that case also the inputs are <code>StaticMatrix</code>, we can make use of <code>Julia</code>&#39;s broadcasting syntax to perform an closure elementwise. </p><pre><code class="language-julia hljs">import OrnsteinZernike.closure_c_from_gamma
function OrnsteinZernike.closure_c_from_gamma(::MyHNC, _, mayer_f, γ, _)
    return @. (mayer_f + 1) * exp(γ) - γ - 1 # note the @.
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="Theory.html">« Theory</a><a class="docs-footer-nextpage" href="ExtendingPotentials.html">Defining your own potentials »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 14 August 2023 14:24">Monday 14 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
