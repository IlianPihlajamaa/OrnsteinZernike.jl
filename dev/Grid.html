<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Choosing Grid Parameters (M and dr) · OrnsteinZernike.jl Documentation</title><meta name="title" content="Choosing Grid Parameters (M and dr) · OrnsteinZernike.jl Documentation"/><meta property="og:title" content="Choosing Grid Parameters (M and dr) · OrnsteinZernike.jl Documentation"/><meta property="twitter:title" content="Choosing Grid Parameters (M and dr) · OrnsteinZernike.jl Documentation"/><meta name="description" content="Documentation for OrnsteinZernike.jl Documentation."/><meta property="og:description" content="Documentation for OrnsteinZernike.jl Documentation."/><meta property="twitter:description" content="Documentation for OrnsteinZernike.jl Documentation."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">OrnsteinZernike.jl Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Index</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="SingleCompLJ.html">First steps</a></li><li><a class="tocitem" href="HardSphereMixture.html">Hard-sphere mixture</a></li><li><a class="tocitem" href="HighDensities.html">Solving at high densities</a></li><li><a class="tocitem" href="OtherDimensions.html">Other dimensions</a></li><li><a class="tocitem" href="Accuracy.html">Accuracy</a></li><li><a class="tocitem" href="ThermodynamicConsistency.html">Thermodynamic Consistency</a></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="GeneralWorkflow.html">General Workflow</a></li><li><a class="tocitem" href="Potentials.html">Interaction Potentials</a></li><li><a class="tocitem" href="Systems.html">Systems</a></li><li><a class="tocitem" href="Closures.html">Closures</a></li><li><a class="tocitem" href="Solvers.html">Solvers</a></li><li class="is-active"><a class="tocitem" href="Grid.html">Choosing Grid Parameters (M and dr)</a><ul class="internal"><li><a class="tocitem" href="#What-Must-Be-Resolved?"><span>What Must Be Resolved?</span></a></li><li><a class="tocitem" href="#Practical-Guidelines"><span>Practical Guidelines</span></a></li><li><a class="tocitem" href="#Example:-Grid-Convergence-with-dr"><span>Example: Grid Convergence with dr</span></a></li></ul></li><li><a class="tocitem" href="Mixtures.html">Mixtures in OrnsteinZernike.jl</a></li></ul></li><li><a class="tocitem" href="Theory.html">Theory</a></li><li><span class="tocitem">Extending</span><ul><li><a class="tocitem" href="ExtendingPotentials.html">Defining your own potentials</a></li><li><a class="tocitem" href="ExtendingClosures.html">Defining your own closure</a></li></ul></li><li><a class="tocitem" href="API.html">API</a></li><li><a class="tocitem" href="FromPython.html">From Python</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Basics</a></li><li class="is-active"><a href="Grid.html">Choosing Grid Parameters (M and dr)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="Grid.html">Choosing Grid Parameters (M and dr)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/IlianPihlajamaa/OrnsteinZernike.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/IlianPihlajamaa/OrnsteinZernike.jl/blob/main/docs/src/Grid.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Choosing-Grid-Parameters-(M-and-dr)"><a class="docs-heading-anchor" href="#Choosing-Grid-Parameters-(M-and-dr)">Choosing Grid Parameters (M and dr)</a><a id="Choosing-Grid-Parameters-(M-and-dr)-1"></a><a class="docs-heading-anchor-permalink" href="#Choosing-Grid-Parameters-(M-and-dr)" title="Permalink"></a></h1><p>The Ornstein–Zernike solvers use <strong>radial Fourier/Hankel transforms</strong> to go between real and Fourier space.   The grid is controlled by two parameters:</p><ul><li><code>M</code> : number of grid points  </li><li><code>dr</code>: approximate radial step size (may not be truly uniform, since Hankel transforms use non-uniform grids in arbitrary dimensions)  </li></ul><p>The <strong>maximum radius</strong> is</p><p>[ r_{\max} = M \cdot dr ]</p><p>which sets the size of the box in real space.</p><hr/><h2 id="What-Must-Be-Resolved?"><a class="docs-heading-anchor" href="#What-Must-Be-Resolved?">What Must Be Resolved?</a><a id="What-Must-Be-Resolved?-1"></a><a class="docs-heading-anchor-permalink" href="#What-Must-Be-Resolved?" title="Permalink"></a></h2><ul><li><p>In <strong>real space</strong>, it is the <strong>direct correlation function (c(r))</strong> that is Fourier transformed.  </p><ul><li>Therefore, <code>dr</code> and <code>rmax</code> must be chosen such that oscillations and decay of (c(r)) are well resolved.  </li><li>Poor resolution of (c(r)) will produce inaccurate structure factors (S(k)).</li><li>In a three-dimensional system, if the potential has discontinuities, they must lie exactly between two gridpoints to ensure second order convergence.</li></ul></li><li><p>In <strong>Fourier space</strong>, the discretization also needs to be accurate.  </p><ul><li>If the (k)-grid is too coarse, long-wavelength properties (e.g. (S(k\to 0))) will be unreliable. Ensure that the direct correlation function (\gamma(k)) is well discretized.</li><li>If (r_{\max}) is too small, aliasing and finite-box effects may distort the Fourier transform.</li></ul></li></ul><hr/><h2 id="Practical-Guidelines"><a class="docs-heading-anchor" href="#Practical-Guidelines">Practical Guidelines</a><a id="Practical-Guidelines-1"></a><a class="docs-heading-anchor-permalink" href="#Practical-Guidelines" title="Permalink"></a></h2><ul><li><strong>Choose dr small enough</strong> to resolve short-range features of the potential and resulting (c(r)).  <ul><li>For hard spheres or Lennard–Jones: <code>dr ≲ 0.05σ</code>.  </li></ul></li><li><strong>Choose rmax large enough</strong> so that (c(r)) has decayed essentially to zero before the cutoff.  <ul><li>A good starting point: <code>rmax ≈ 10σ</code>.  </li></ul></li><li><strong>Increase M</strong> together with decreasing dr if necessary — this improves both real-space and Fourier-space resolution.  </li><li><strong>Check convergence</strong>: repeat a calculation with finer grid and verify (g(r)), (S(k)), and thermodynamic routes are stable.</li></ul><hr/><h2 id="Example:-Grid-Convergence-with-dr"><a class="docs-heading-anchor" href="#Example:-Grid-Convergence-with-dr">Example: Grid Convergence with dr</a><a id="Example:-Grid-Convergence-with-dr-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Grid-Convergence-with-dr" title="Permalink"></a></h2><pre><code class="language-julia hljs">using OrnsteinZernike, Plots

system = SimpleLiquid(3, 0.8, 1.0, LennardJones(1.0, 1.0))
closure = HypernettedChain()

Rmax = 10.0
p1 = plot(xlims=(0,2), xlabel=&quot;r&quot;, ylabel=&quot;c(r)&quot;)
p2 = plot(xlims=(0,20), xlabel=&quot;k&quot;, ylabel=&quot;c(k)&quot;)
for M in [1000, 100, 50]
    dr = Rmax/M
    sol  = @time solve(system, closure, NgIteration(M=M, dr=dr))
    kmax = round(maximum(sol.k), digits=2)
    plot!(p1, sol.r, sol.cr, label=&quot;M=$M, kmax=$(kmax)&quot;, ls=:dash, markers=:o, legend=false)
    plot!(p2, sol.k, sol.ck, label=&quot;M=$M, kmax=$(kmax)&quot;, ls=:dash, markers=:o, legend=:bottomright)
end
display(plot(p1,p2))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">After iteration 0, the error is 8.13170801569.
After iteration 10, the error is 6.2030864521.
After iteration 20, the error is 0.38583419355.
After iteration 30, the error is 3.35326e-5.
After iteration 40, the error is 2.402e-8.
Converged after 46 iterations, the error is 8.5e-11.
  0.993949 seconds (752.92 k allocations: 37.337 MiB, 1.98% gc time, 99.78% compilation time)
After iteration 0, the error is 2.70974354173.
After iteration 10, the error is 1.77538968751.
After iteration 20, the error is 0.10734410666.
After iteration 30, the error is 2.972445e-5.
After iteration 40, the error is 3.23e-9.
Converged after 45 iterations, the error is 6.5e-11.
  0.000400 seconds (548 allocations: 883.422 KiB)
After iteration 0, the error is 53.96901689238.
After iteration 10, the error is 0.93409779905.
After iteration 20, the error is 0.08035914126.
After iteration 30, the error is 0.00235930013.
After iteration 40, the error is 3.892e-8.
Converged after 50 iterations, the error is 6.0e-11.
  0.000303 seconds (578 allocations: 871.062 KiB)</code></pre><p>Here the coarse grid under-resolves oscillations in (c(r)) and doesn&#39;t capture it&#39;s decay in Fourier space, which in turn leads to distorted structure factors (S(k)).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="Solvers.html">« Solvers</a><a class="docs-footer-nextpage" href="Mixtures.html">Mixtures in OrnsteinZernike.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 27 August 2025 09:29">Wednesday 27 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
